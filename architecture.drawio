<mxfile host="app.diagrams.net" modified="2024-11-27T00:00:00.000Z" agent="Kiro" version="22.0.0">
  <diagram name="S3 Signed URL Generator Architecture" id="architecture">
    <mxGraphModel dx="1434" dy="844" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="Serverless S3 Signed URL Generator Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="320" y="30" width="530" height="40" as="geometry" />
        </mxCell>
        
        <!-- Client -->
        <mxCell id="client" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#232F3D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.client;" vertex="1" parent="1">
          <mxGeometry x="80" y="250" width="78" height="76" as="geometry" />
        </mxCell>
        <mxCell id="client-label" value="Client Application" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="59" y="336" width="120" height="30" as="geometry" />
        </mxCell>
        
        <!-- API Gateway -->
        <mxCell id="apigw" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#FF4F8B;gradientDirection=north;fillColor=#BC1356;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.api_gateway;" vertex="1" parent="1">
          <mxGeometry x="320" y="249" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="apigw-label" value="API Gateway&lt;br&gt;REST API" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="299" y="337" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="apigw-tag" value="Tag: project=chervon" style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="289" y="375" width="140" height="20" as="geometry" />
        </mxCell>
        
        <!-- Lambda Function -->
        <mxCell id="lambda" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.lambda;" vertex="1" parent="1">
          <mxGeometry x="560" y="249" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="lambda-label" value="Lambda Function&lt;br&gt;(Node.js 20.x)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="539" y="337" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lambda-tag" value="Tag: project=chervon" style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="529" y="375" width="140" height="20" as="geometry" />
        </mxCell>
        
        <!-- S3 Buckets -->
        <mxCell id="s3" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#60A337;gradientDirection=north;fillColor=#277116;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.s3;" vertex="1" parent="1">
          <mxGeometry x="800" y="249" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="s3-label" value="S3 Buckets&lt;br&gt;(Multiple)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="779" y="337" width="120" height="30" as="geometry" />
        </mxCell>
        
        <!-- IAM User -->
        <mxCell id="iam" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F54749;gradientDirection=north;fillColor=#C7131F;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.iam;" vertex="1" parent="1">
          <mxGeometry x="560" y="480" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="iam-label" value="IAM User&lt;br&gt;(AKSK Credentials)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="539" y="568" width="120" height="30" as="geometry" />
        </mxCell>
        
        <!-- Arrows -->
        <!-- Client to API Gateway -->
        <mxCell id="arrow1" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1" source="client" target="apigw">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="450" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow1-label" value="POST /&lt;br&gt;{s3Path: &quot;s3://bucket/key&quot;}" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="arrow1">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint x="5" y="-20" as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- API Gateway to Lambda -->
        <mxCell id="arrow2" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1" source="apigw" target="lambda">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="450" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow2-label" value="Invoke" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="arrow2">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint y="-10" as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- Lambda to S3 -->
        <mxCell id="arrow3" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1" source="lambda" target="s3">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="450" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow3-label" value="Generate&lt;br&gt;Pre-signed URL" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="arrow3">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint y="-20" as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- IAM to Lambda (dashed) -->
        <mxCell id="arrow4" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#666666;dashed=1;" edge="1" parent="1" source="iam" target="lambda">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="450" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow4-label" value="Uses AKSK&lt;br&gt;Credentials" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="arrow4">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint x="20" y="10" as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- Return arrows (dashed) -->
        <mxCell id="arrow5" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#0066CC;dashed=1;startArrow=none;" edge="1" parent="1" source="apigw" target="client">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="450" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow5-label" value="Signed URL Response" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#0066CC;" vertex="1" connectable="0" parent="arrow5">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint x="-5" y="20" as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- Environment Variables Box -->
        <mxCell id="env-box" value="Environment Variables" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="480" y="120" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="env-text" value="• SIGNED_URL_EXPIRATION: 3600&lt;br&gt;• Owner_Access_Key: [IAM User]&lt;br&gt;• Owner_Secret_KEY: [IAM User]" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="490" y="145" width="220" height="50" as="geometry" />
        </mxCell>
        
        <!-- Features Box -->
        <mxCell id="features-box" value="Key Features" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;verticalAlign=top;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="450" width="280" height="140" as="geometry" />
        </mxCell>
        <mxCell id="features-text" value="✓ Multi-bucket support (any S3 bucket)&lt;br&gt;✓ S3 URI format: s3://bucket/key&lt;br&gt;✓ Configurable URL expiration (default: 1 hour)&lt;br&gt;✓ CORS enabled (all origins)&lt;br&gt;✓ Comprehensive error handling&lt;br&gt;✓ Input validation (bucket name, object key)&lt;br&gt;✓ AKSK-based authentication" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="90" y="475" width="260" height="110" as="geometry" />
        </mxCell>
        
        <!-- Security Note -->
        <mxCell id="security-box" value="⚠️ Security: AKSK credentials stored in Lambda environment variables. Use AWS Secrets Manager for production." style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=center;verticalAlign=middle;fontSize=10;fontStyle=2" vertex="1" parent="1">
          <mxGeometry x="400" y="650" width="480" height="40" as="geometry" />
        </mxCell>
        
        <!-- Flow Description -->
        <mxCell id="flow-title" value="Request Flow:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="620" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="flow-text" value="1. Client sends POST request with S3 path&lt;br&gt;2. API Gateway forwards to Lambda&lt;br&gt;3. Lambda authenticates using AKSK credentials&lt;br&gt;4. Lambda generates pre-signed URL for S3 object&lt;br&gt;5. Signed URL returned to client (valid for 1 hour)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="80" y="645" width="300" height="80" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>